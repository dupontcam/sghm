// Define a fonte de dados (nosso banco PostgreSQL no Docker)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Define o gerador do Cliente Prisma
// CORREÇÃO: Removida a linha 'output' para usar o local padrão (node_modules/.prisma/client)
generator client {
  provider = "prisma-client-js"
}

// --- Enums ---
// Estes tipos foram criados no schema.sql e o Prisma os identifica
enum role_usuario {
  ADMIN
  OPERADOR
}

enum tipo_pagamento {
  PARTICULAR
  PLANO_SAUDE
}

enum status_pagamento {
  PENDENTE
  PAGO
  GLOSA
}

// --- Models (Tabelas) ---

// Model para a tabela 'usuarios'
model usuarios {
  id            Int          @id @default(autoincrement())
  nome_completo String       @db.VarChar(100)
  email         String       @unique @db.VarChar(100)
  senha         String       @db.VarChar(255)
  cpf           String?      @unique @db.VarChar(14)
  telefone      String?      @db.VarChar(20)
  role          role_usuario @default(OPERADOR)
  created_at    DateTime     @default(now()) @db.Timestamptz(6)
  updated_at    DateTime     @default(now()) @db.Timestamptz(6)

  // Relacionamentos: Um usuário pode ter incluído ou alterado muitas consultas
  consultas_alteradas consultas[] @relation("consultas_alteradas_por")
  consultas_incluidas consultas[] @relation("consultas_incluidas_por")
}

// Model para a tabela 'medicos'
model medicos {
  id            Int         @id @default(autoincrement())
  nome_medico   String      @db.VarChar(100)
  especialidade String?     @db.VarChar(100)
  crm           String      @unique @db.VarChar(20)
  cnpj_cpf      String?     @db.VarChar(18)
  email         String?     @db.VarChar(100)
  telefone      String?     @db.VarChar(20)
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  updated_at    DateTime    @default(now()) @db.Timestamptz(6)

  // Relacionamento: Um médico pode ter muitas consultas
  consultas consultas[]
}

// Model para a tabela 'pacientes'
model pacientes {
  id                 Int         @id @default(autoincrement())
  nome_paciente      String      @db.VarChar(100)
  data_nascimento    DateTime?   @db.Date
  cpf                String?     @unique(map: "pacientes_cpf_key") @db.VarChar(14)
  email              String?     @db.VarChar(100)
  telefone           String?     @db.VarChar(20)
  plano_saude        String?     @db.VarChar(100)
  numero_carteirinha String?     @db.VarChar(50)
  created_at         DateTime    @default(now()) @db.Timestamptz(6)
  updated_at         DateTime    @default(now()) @db.Timestamptz(6)

  // Relacionamento: Um paciente pode ter muitas consultas
  consultas consultas[]
}

// Model para a tabela 'consultas'
model consultas {
  id                     Int              @id @default(autoincrement())
  data_consulta          DateTime         @db.Date
  protocolo              String           @unique @db.VarChar(50)
  consultorio            String?          @db.VarChar(100)
  tipo_pagamento         tipo_pagamento
  valor_bruto            Decimal          @db.Decimal(10, 2)
  valor_glosa            Decimal?         @default(0.00) @db.Decimal(10, 2)
  valor_recebido         Decimal?         @default(0.00) @db.Decimal(10, 2)
  data_recebimento       DateTime?        @db.Date
  status_pagamento       status_pagamento @default(PENDENTE)
  descricao_procedimento String?          @db.VarChar(255)
  medico_id              Int
  paciente_id            Int
  usuario_inclusao_id    Int
  usuario_alteracao_id   Int
  created_at             DateTime         @default(now()) @db.Timestamptz(6)
  updated_at             DateTime         @default(now()) @db.Timestamptz(6)

  // Relacionamentos com as outras tabelas
  medico            medicos  @relation(fields: [medico_id], references: [id], onDelete: Restrict)
  paciente          pacientes @relation(fields: [paciente_id], references: [id], onDelete: Restrict)
  usuario_alteracao usuarios @relation("consultas_alteradas_por", fields: [usuario_alteracao_id], references: [id], onDelete: Restrict)
  usuario_inclusao  usuarios @relation("consultas_incluidas_por", fields: [usuario_inclusao_id], references: [id], onDelete: Restrict)

  // Índices para otimizar buscas
  @@index([medico_id])
  @@index([paciente_id])
  @@index([usuario_inclusao_id])
  @@index([usuario_alteracao_id])
}

